<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SOKRP ‚Äî NDA Signing</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#071528; --card:#081827; --muted:#9aa4b2; --accent:#6d28d9;
    --text:#e6eef8; --panel:#0b2130; --sig-bg:#0e1118;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;
    background:
      radial-gradient(1000px 400px at 10% 10%, rgba(23,30,44,0.25), transparent),
      linear-gradient(180deg,#041225 0%, #071428 100%); color:var(--text)}
  .wrap{max-width:1200px;margin:28px auto;padding:22px}
  .card{background:var(--card);border-radius:12px;padding:20px;border:1px solid rgba(255,255,255,0.02);box-shadow:0 8px 40px rgba(2,6,23,0.6)}
  header{display:flex;align-items:center;gap:16px;margin-bottom:18px}
  .logo img{width:64px;height:64px;border-radius:10px;object-fit:cover;box-shadow:0 6px 18px rgba(124,58,237,0.12)}
  h1{font-size:20px;margin:0}
  p.lead{color:var(--muted);margin:6px 0 0;font-size:13px}
  .grid{display:grid;grid-template-columns:1fr 420px;gap:18px;margin-top:18px;align-items:start}
  label{display:block;color:var(--muted);font-size:13px;margin-top:12px}
  input[type=text], textarea{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:var(--text);margin-top:8px}
  textarea{min-height:96px;resize:vertical}
  .muted{color:var(--muted);font-size:13px;margin-top:10px}
  #signature-pad{width:100%;height:220px;border-radius:8px;background:#f9fafb;display:block;touch-action:none;border:2px dashed rgba(255,255,255,0.08)}
  .controls{display:flex;gap:10px;margin-top:10px;align-items:center;flex-wrap:wrap}
  .btn{background:var(--accent);color:white;padding:10px 14px;border-radius:8px;border:0;cursor:pointer;font-weight:600}
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
  .btn.small{padding:8px 10px;font-size:14px}
  .status{font-size:13px;color:var(--muted);margin-left:10px}
  .nda-view{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));padding:14px;border-radius:8px;height:600px;overflow:auto;border:1px solid rgba(255,255,255,0.02);color:#dfe9f6}
  .nda-view h2{margin:0 0 8px;font-size:20px}
  .nda-view p{line-height:1.4;color:#cfe3f7;font-size:13px}
  .sig-small-wrap{display:flex;align-items:center;gap:20px;background:var(--panel);border:1px solid rgba(255,255,255,0.05);border-radius:10px;padding:12px 14px;margin-top:18px}
  .sig-small-wrap span.label{font-size:13px;color:var(--muted)}
  .sig-small-box{flex:0 0 auto;width:280px;height:80px;background:var(--sig-bg);border-radius:6px;display:flex;align-items:center;justify-content:center;border:1px solid rgba(255,255,255,0.06)}
  .sig-small-box img{max-width:100%;max-height:70px;border-radius:4px;object-fit:contain}
  @media (max-width:980px){ .grid{grid-template-columns:1fr;} .nda-view{height:320px} #signature-pad{height:160px} .sig-small-box{width:240px;height:72px} }
  /* status badge */
  .ok { color: #33cc66; font-weight:700; margin-left:8px; }
  .err { color: #ff6b6b; font-weight:700; margin-left:8px; }
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <header>
        <div class="logo"><img src="logo.png" onerror="this.src='https://cdn.discordapp.com/attachments/1437638010903465984/1437953301130772582/SOKRP_Dev_Logo_2.png'"></div>
        <div>
          <h1>State of Kentucky Roleplay ‚Äî NDA Signing</h1>
          <p class="lead">Please read the NDA, fill details, sign, and submit. Your signed NDA was disclosed to SOKRP Development Management.</p>
        </div>
      </header>

      <div class="grid">
        <div class="left">
          <label>Full Roleplay Name</label>
          <input id="name" type="text" placeholder="Your Full Roleplay Name">

          <label>Discord ID</label>
          <input id="discordId" type="text" placeholder="123456789012345678">

          <label>Team / Role</label>
          <input id="role" type="text" placeholder="Software / Graphics / Media">

          <label>Notes (optional)</label>
          <textarea id="notes" placeholder="Any notes..."></textarea>

          <label>Signature (draw below)</label>
          <canvas id="signature-pad" aria-label="signature pad"></canvas>

          <div class="controls">
            <button id="clear" class="btn ghost small">Clear</button>
            <button id="undo" class="btn ghost small">Undo</button>
            <div style="flex:1"></div>
            <button id="submitBtn" class="btn">Generate & Send NDA Image</button>
            <div id="status" class="status"></div>
          </div>

          <div class="muted">By submitting you agree this signature indicates acceptance.</div>

          <div class="sig-small-wrap">
            <span class="label">Signature preview:</span>
            <div class="sig-small-box" id="sigSmallBox"><span style="color:var(--muted);font-size:13px">No signature yet</span></div>
          </div>
        </div>

        <aside class="right">
          <div class="nda-view" id="ndaPreview">
            <h2>NON-DISCLOSURE AGREEMENT</h2>
            <p><strong>PARTIES</strong><br>
            This Non-Disclosure Agreement is entered into on <span id="ndadate"></span>, by <strong>State of Kentucky Roleplay Development Command</strong> and between <strong><span id="previewName">[Enter your name here]</span></strong>.</p>

            <p><strong>CONFIDENTIAL INFORMATION</strong><br>
            The Receiving Party agrees not to disclose, copy, clone, or modify any confidential information related to the SOKRP and agrees not to use any such information without obtaining consent.</p>

            <p>‚ÄúConfidential information‚Äù refers to any data and/or information that is related to the Disclosing Party, in any form, including, but not limited to, oral or written. Such confidential information includes, but is not limited to, any information related to the business or industry of the SOKRP, such as discoveries, processes, techniques, programs, knowledge bases.</p>

            <p><strong>RETURN OF CONFIDENTIAL INFORMATION</strong><br>
            The Receiving Party agrees to return all the confidential information to the SOKRP Development team upon the termination of this Agreement.</p>

            <p><strong>OWNERSHIP</strong><br>
            This Agreement is not transferable and may only be transferred by written consent provided by both Parties.</p>

            <p><strong>SIGNATURE AND DATE</strong><br>
            The Parties hereby agree to the terms and conditions set forth in this Agreement and such is demonstrated by their signatures below:</p>

            <p><em>SOKRP Development Team Management</em></p>
            <hr style="opacity:0.06;border-color:rgba(255,255,255,0.04)">
            <p><strong>Signed by:</strong> <span id="sigPreviewName">[NAME]</span></p>
            <p><strong>Discord ID:</strong> <span id="sigPreviewDiscord">[DISCORD ID]</span></p>
            <div id="sigPreviewImage" style="margin-top:8px"></div>
            <p style="margin-top:10px;color:var(--muted);font-size:12px">Note: A single NDA image will be posted to Discord as the official record.</p>
          </div>
        </aside>
      </div>
    </div>
  </div>

  <!-- hidden render canvas -->
  <canvas id="renderCanvas" width="1200" height="1400" style="display:none"></canvas>

<script>
/* ---------------- CONFIG ---------------- */
const WEBHOOK_URL = "https://discord.com/api/webhooks/1438592976279437404/uf4h0RutBfteN4l_lRNZTfEY8cfj1kGiaybSY4D2B-dF1ZlFCzkEx_FLiQq1ancCKHjs";
const LOGO_SRC_LOCAL = "logo.png";
const LOGO_FALLBACK = "https://cdn.discordapp.com/attachments/1437638010903465984/1437953301130772582/SOKRP_Dev_Logo_2.png";

/* ---------------- DOM ---------------- */
const ndadateEl = document.getElementById('ndadate');
const nameEl = document.getElementById('name');
const discordEl = document.getElementById('discordId');
const roleEl = document.getElementById('role');
const notesEl = document.getElementById('notes');
const statusEl = document.getElementById('status');
const submitBtn = document.getElementById('submitBtn');
const sigSmallBox = document.getElementById('sigSmallBox');
const sigPreviewName = document.getElementById('sigPreviewName');
const sigPreviewDiscord = document.getElementById('sigPreviewDiscord');
const previewName = document.getElementById('previewName');
const sigPreviewImage = document.getElementById('sigPreviewImage');

ndadateEl.textContent = new Date().toLocaleDateString();

/* ---------------- Signature pad (high-DPI aware) ---------------- */
const canvas = document.getElementById('signature-pad');
const ctx = canvas.getContext('2d');

function resizeSignatureCanvas(){
  const ratio = window.devicePixelRatio || 1;
  // CSS size (get computed)
  const rect = canvas.getBoundingClientRect();
  const cssWidth = rect.width || 600;
  const cssHeight = rect.height || 220;
  // set drawing buffer
  canvas.width = Math.round(cssWidth * ratio);
  canvas.height = Math.round(cssHeight * ratio);
  // set transform so we draw in CSS pixel coordinates
  ctx.setTransform(ratio, 0, 0, ratio, 0, 0);
  // fill background white
  ctx.fillStyle = '#f9fafb';
  ctx.fillRect(0,0,cssWidth,cssHeight);
  ctx.lineWidth = 2;
  ctx.strokeStyle = '#000';
  ctx.lineCap = 'round';
}
resizeSignatureCanvas();

/* store strokes in CSS coordinate space (client coords relative to canvas) */
let drawing = false;
let currentPath = [];
const paths = [];

/* get pointer pos in CSS coords */
function getPos(e){
  const rect = canvas.getBoundingClientRect();
  const clientX = (e.touches && e.touches[0]) ? e.touches[0].clientX : e.clientX;
  const clientY = (e.touches && e.touches[0]) ? e.touches[0].clientY : e.clientY;
  return { x: clientX - rect.left, y: clientY - rect.top };
}

/* on resize we must redraw stored paths (they are in CSS coords) */
function redrawPaths(){
  // clear & background
  const rect = canvas.getBoundingClientRect();
  ctx.fillStyle = '#f9fafb';
  ctx.fillRect(0,0,rect.width,rect.height);
  ctx.lineWidth = 2;
  ctx.strokeStyle = '#000';
  ctx.lineCap = 'round';
  for(const s of paths){
    if(!s.length) continue;
    ctx.beginPath();
    ctx.moveTo(s[0].x, s[0].y);
    for(let i=1;i<s.length;i++) ctx.lineTo(s[i].x, s[i].y);
    ctx.stroke();
  }
}

/* pointer events */
canvas.addEventListener('pointerdown', e => {
  drawing = true;
  currentPath = [];
  const p = getPos(e);
  currentPath.push(p);
  ctx.beginPath();
  ctx.moveTo(p.x, p.y);
});
canvas.addEventListener('pointermove', e => {
  if(!drawing) return;
  const p = getPos(e);
  currentPath.push(p);
  ctx.lineTo(p.x, p.y);
  ctx.stroke();
});
canvas.addEventListener('pointerup', e => {
  if(!drawing) return;
  drawing = false;
  paths.push(currentPath.slice());
  updateSmallPreview();
  updatePreviewText();
});
canvas.addEventListener('pointercancel', ()=>{ drawing=false; });

/* keep strokes after resize */
window.addEventListener('resize', () => {
  // preserve drawn paths, resize canvas and redraw them
  resizeSignatureCanvas();
  redrawPaths();
  // update small preview from new coords
  updateSmallPreview();
});

/* clear / undo */
document.getElementById('clear').addEventListener('click', () => {
  paths.length = 0;
  currentPath = [];
  resizeSignatureCanvas();
  redrawPaths();
  sigSmallBox.innerHTML = '<span style="color:var(--muted);font-size:13px">No signature yet</span>';
  sigPreviewImage.innerHTML = '';
});
document.getElementById('undo').addEventListener('click', () => {
  paths.pop();
  resizeSignatureCanvas();
  redrawPaths();
  updateSmallPreview();
  updatePreviewText();
});

/* convert stored paths into a dataURL (draw onto tmp canvas) */
function signaturePathsToDataURL() {
  if(paths.length === 0) return null;
  const w = canvas.clientWidth;
  const h = canvas.clientHeight;
  const tmp = document.createElement('canvas');
  tmp.width = w;
  tmp.height = h;
  const c = tmp.getContext('2d');
  c.fillStyle = '#f9fafb'; c.fillRect(0,0,w,h);
  c.strokeStyle = '#000'; c.lineWidth = 2; c.lineCap = 'round';
  for(const s of paths){
    if(!s.length) continue;
    c.beginPath();
    c.moveTo(s[0].x, s[0].y);
    for(let i=1;i<s.length;i++) c.lineTo(s[i].x, s[i].y);
    c.stroke();
  }
  return tmp.toDataURL('image/png');
}

/* small preview: tightly crop bounding box and draw into fixed small canvas */
function updateSmallPreview(){
  if(paths.length===0){
    sigSmallBox.innerHTML = '<span style="color:var(--muted);font-size:13px">No signature yet</span>';
    sigPreviewImage.innerHTML = '';
    return;
  }
  const all = paths.flat();
  let minX=Infinity,minY=Infinity,maxX=-Infinity,maxY=-Infinity;
  for(const p of all){
    if(p.x < minX) minX = p.x;
    if(p.y < minY) minY = p.y;
    if(p.x > maxX) maxX = p.x;
    if(p.y > maxY) maxY = p.y;
  }
  const pad = 6;
  minX = Math.max(0, minX - pad);
  minY = Math.max(0, minY - pad);
  maxX = Math.min(canvas.clientWidth, maxX + pad);
  maxY = Math.min(canvas.clientHeight, maxY + pad);
  const sigW = Math.max(1, maxX - minX);
  const sigH = Math.max(1, maxY - minY);

  const outW = 280, outH = 80;
  const tmp = document.createElement('canvas');
  tmp.width = outW; tmp.height = outH;
  const c = tmp.getContext('2d');
  c.fillStyle = '#111418'; c.fillRect(0,0,outW,outH);
  c.strokeStyle = '#e6eef8'; c.lineWidth = 2; c.lineCap='round';

  const scale = Math.min((outW - 12) / sigW, (outH - 12) / sigH);
  const dx = (outW - sigW * scale) / 2;
  const dy = (outH - sigH * scale) / 2;
  c.save();
  c.translate(dx - minX * scale, dy - minY * scale);
  c.scale(scale, scale);
  for(const s of paths){
    if(!s.length) continue;
    c.beginPath();
    c.moveTo(s[0].x, s[0].y);
    for(let i=1;i<s.length;i++) c.lineTo(s[i].x, s[i].y);
    c.stroke();
  }
  c.restore();
  const img = new Image();
  img.src = tmp.toDataURL('image/png');
  img.alt = "signature preview";
  sigSmallBox.innerHTML = '';
  sigSmallBox.appendChild(img);

  // also update NDA preview small signature
  sigPreviewImage.innerHTML = '';
  const bigImg = new Image();
  bigImg.src = tmp.toDataURL('image/png');
  bigImg.style.maxWidth = '320px';
  bigImg.style.border = '1px solid rgba(255,255,255,0.06)';
  bigImg.style.borderRadius = '4px';
  sigPreviewImage.appendChild(bigImg);
}

/* preview text update */
function updatePreviewText(){
  previewName.textContent = nameEl.value || '[Enter your name here]';
  sigPreviewName.textContent = nameEl.value || '[NAME]';
  sigPreviewDiscord.textContent = discordEl.value || '[DISCORD ID]';
}

/* ---------------- Render NDA to hidden canvas & upload ---------------- */
const renderCanvas = document.getElementById('renderCanvas');
const rctx = renderCanvas.getContext('2d');

/* load logo (local with fallback) */
async function loadLogo(){
  return new Promise(resolve => {
    const img = new Image();
    img.crossOrigin = 'anonymous';
    img.onload = () => resolve(img);
    img.onerror = () => {
      const fb = new Image();
      fb.crossOrigin = 'anonymous';
      fb.onload = () => resolve(fb);
      fb.src = LOGO_FALLBACK;
    };
    img.src = LOGO_SRC_LOCAL;
  });
}

/* full NDA text */
const FULL_NDA_TEXT = `PARTIES
This Non-Disclosure Agreement is entered into on (enter date), by State of Kentucky Roleplay Development Command and between (Enter your name here).

CONFIDENTIAL INFORMATION
The Receiving Party agrees not to disclose, copy, clone, or modify any confidential information related to the SOKRP and agrees not to use any such information without obtaining consent.
‚ÄúConfidential information‚Äù refers to any data and/or information that is related to the Disclosing Party, in any form, including, but not limited to, oral or written. Such confidential information includes, but is not limited to, any information related to the business or industry of the SOKRP, such as discoveries, processes, techniques, programs, knowledge bases.

RETURN OF CONFIDENTIAL INFORMATION
The Receiving Party agrees to return all the confidential information to the SOKRP Development team upon the termination of this Agreement.

OWNERSHIP
This Agreement is not transferable and may only be transferred by written consent provided by both Parties.

SIGNATURE AND DATE
The Parties hereby agree to the terms and conditions set forth in this Agreement and such is demonstrated by their signatures below:

SOKRP Development Team Management

`;

/* wrap helper */
function wrapText(ctx, text, x, y, maxWidth, lineHeight) {
  const paragraphs = text.split('\n');
  for (let p = 0; p < paragraphs.length; p++){
    let words = paragraphs[p].split(' ');
    let line = '';
    for (let n = 0; n < words.length; n++) {
      const testLine = line + words[n] + ' ';
      const metrics = ctx.measureText(testLine);
      const testWidth = metrics.width;
      if (testWidth > maxWidth && n > 0) {
        ctx.fillText(line, x, y);
        line = words[n] + ' ';
        y += lineHeight;
      }
      else {
        line = testLine;
      }
    }
    ctx.fillText(line, x, y);
    y += lineHeight;
  }
  return y;
}

/* draw NDA */
async function drawNDAToCanvas({ name, discordId, role, notes, dateStr }) {
  // canvas already set to 1200x1400
  const W = renderCanvas.width;
  const H = renderCanvas.height;

  // clear bg
  rctx.fillStyle = "#0b1220";
  rctx.fillRect(0,0,W,H);

  // document card (slightly inset)
  const margin = 40;
  const docX = margin;
  const docY = margin;
  const docW = W - margin*2;
  const docH = H - margin*2;
  rctx.fillStyle = "#0c1c28";
  rctx.fillRect(docX, docY, docW, docH);

  // load logo
  const logo = await loadLogo();
  const logoSize = 120;
  rctx.drawImage(logo, docX + (docW - logoSize)/2, docY + 28, logoSize, logoSize);

  // title
  rctx.fillStyle = "#e6eef8";
  rctx.font = "700 28px Inter, Arial";
  rctx.textAlign = "center";
  rctx.fillText("NON-DISCLOSURE AGREEMENT", docX + docW/2, docY + 28 + logoSize + 36);

  // meta
  rctx.font = "13px Inter, Arial";
  rctx.fillStyle = "#9fb6c9";
  rctx.textAlign = "left";
  rctx.fillText(`Date: ${dateStr}`, docX + 36, docY + 28 + logoSize + 72);

  // divider
  rctx.strokeStyle = "rgba(255,255,255,0.04)";
  rctx.lineWidth = 1;
  rctx.beginPath();
  rctx.moveTo(docX + 36, docY + 28 + logoSize + 82);
  rctx.lineTo(docX + docW - 36, docY + 28 + logoSize + 82);
  rctx.stroke();

  // body
  const bodyX = docX + 36;
  let cursorY = docY + 28 + logoSize + 110;
  rctx.fillStyle = "#dfe9f6";
  rctx.font = "13px Inter, Arial";
  rctx.textAlign = "left";
  const replaced = FULL_NDA_TEXT.replace("(enter date)", dateStr).replace("(Enter your name here)", name || '[NAME]');
  cursorY = wrapText(rctx, replaced, bodyX, cursorY, docW - 72, 20);

  // signature block
  const signBoxH = 160;
  const signBoxY = docY + docH - signBoxH - 36;
  rctx.fillStyle = "#08151c";
  rctx.fillRect(bodyX, signBoxY, docW - 72, signBoxH);
  rctx.strokeStyle = "rgba(255,255,255,0.06)";
  rctx.strokeRect(bodyX, signBoxY, docW - 72, signBoxH);

  // left details
  rctx.fillStyle = "#9fb6c9";
  rctx.font = "13px Inter, Arial";
  let ly = signBoxY + 28;
  rctx.fillText("Signed by:", bodyX + 12, ly);
  rctx.fillStyle = "#e6eef8"; rctx.font="700 15px Inter, Arial";
  rctx.fillText(name, bodyX + 110, ly);

  ly += 26;
  rctx.font = "13px Inter, Arial"; rctx.fillStyle="#9fb6c9";
  rctx.fillText("Discord ID:", bodyX + 12, ly);
  rctx.fillStyle = "#e6eef8"; rctx.fillText(discordId, bodyX + 110, ly);

  ly += 26;
  rctx.fillStyle="#9fb6c9"; rctx.fillText("Role:", bodyX + 12, ly);
  rctx.fillStyle="#e6eef8"; rctx.fillText(role || 'N/A', bodyX + 110, ly);

  ly += 26;
  rctx.fillStyle="#9fb6c9"; rctx.fillText("Notes:", bodyX + 12, ly);
  rctx.fillStyle="#e6eef8";
  wrapText(rctx, notes || 'N/A', bodyX + 110, ly, (docW - 72) - 240, 18);

  // signature darker box on right
  const sigBoxW = 400;
  const sigBoxX = bodyX + (docW - 72) - sigBoxW - 12;
  const sigBoxY = signBoxY + 12;
  const sigBoxH2 = 120;
  rctx.fillStyle = "#030a0f"; // darker
  rctx.fillRect(sigBoxX, sigBoxY, sigBoxW, sigBoxH2);
  rctx.strokeStyle = "rgba(255,255,255,0.12)";
  rctx.strokeRect(sigBoxX, sigBoxY, sigBoxW, sigBoxH2);

  rctx.font = "12px Inter, Arial"; rctx.fillStyle = "#7fa4bc";
  rctx.fillText("Signature", sigBoxX + 8, sigBoxY - 6);

  // if signature exists, crop & draw it into the darker box
  if(paths.length > 0){
    const all = paths.flat();
    const minX = Math.max(0, Math.min(...all.map(p=>p.x)));
    const minY = Math.max(0, Math.min(...all.map(p=>p.y)));
    const maxX = Math.min(canvas.clientWidth, Math.max(...all.map(p=>p.x)));
    const maxY = Math.min(canvas.clientHeight, Math.max(...all.map(p=>p.y)));
    const sigW = Math.max(1, maxX - minX);
    const sigH = Math.max(1, maxY - minY);

    // get data url of the full signature (in CSS coords)
    const raw = signaturePathsToDataURL();
    // create temp and draw cropped region
    const tmp = document.createElement('canvas');
    tmp.width = sigW;
    tmp.height = sigH;
    const tctx = tmp.getContext('2d');

    await new Promise(res => {
      const img = new Image();
      img.onload = () => {
        // draw source image then crop
        tctx.drawImage(img, minX, minY, sigW, sigH, 0, 0, sigW, sigH);
        res();
      };
      img.src = raw;
    });

    // scale to fit signature box
    const padding = 12;
    const targetW = sigBoxW - padding*2;
    const targetH = sigBoxH2 - padding*2;
    const scale = Math.min(targetW / sigW, targetH / sigH);
    const drawW = sigW * scale;
    const drawH = sigH * scale;
    const drawX = sigBoxX + (sigBoxW - drawW) / 2;
    const drawY = sigBoxY + (sigBoxH2 - drawH) / 2;

    rctx.drawImage(tmp, 0, 0, sigW, sigH, drawX, drawY, drawW, drawH);

    // date under signature
    rctx.fillStyle = "rgba(159,182,201,0.8)";
    rctx.font = "12px Inter, Arial";
    rctx.fillText(`Date: ${dateStr}`, drawX, drawY + drawH + 18);
  } else {
    rctx.fillStyle = "rgba(120,140,150,0.5)";
    rctx.font = "13px Inter, Arial";
    rctx.fillText("No signature provided", sigBoxX + 12, sigBoxY + 28);
  }

  // footer
  rctx.font = "12px Inter, Arial";
  rctx.fillStyle = "rgba(180,200,220,0.4)";
  rctx.fillText("¬© 2025 State of Kentucky Roleplay ‚Äî All Rights Reserved.", docX + 24, docY + docH - 10);
}

/* ---------------- Submit flow: render & upload ---------------- */
async function submitNDA() {
  const name = nameEl.value.trim();
  const discordId = discordEl.value.trim();
  const role = roleEl.value.trim();
  const notes = notesEl.value.trim();
  const dateStr = new Date().toLocaleDateString();

  if(!name){ alert('Please enter your roleplay name.'); nameEl.focus(); return; }
  if(!discordId){ alert('Please enter your Discord ID.'); discordEl.focus(); return; }
  if(paths.length === 0){ alert('Please provide a signature before submitting.'); return; }

  submitBtn.disabled = true;
  statusEl.innerHTML = 'Rendering NDA image...';

  try {
    await drawNDAToCanvas({ name, discordId, role, notes, dateStr });

    // convert to blob
    const blob = await new Promise(res => renderCanvas.toBlob(res, 'image/png', 0.95));

    statusEl.innerHTML = 'Uploading to Discord...';

    const embed = {
      title: "üìù NDA Disclosure Recorded",
      color: 0x6d28d9,
      thumbnail: { url: LOGO_FALLBACK },
      fields: [
        { name: "Name", value: name, inline: true },
        { name: "Discord ID", value: discordId, inline: true },
        { name: "Role", value: role || 'N/A', inline: true },
        { name: "Notes", value: notes || 'N/A', inline: false }
      ],
      footer: { text: "SOKRP Development Command ‚Ä¢ NDA System", icon_url: LOGO_FALLBACK },
      timestamp: new Date().toISOString()
    };

    const form = new FormData();
    form.append('payload_json', JSON.stringify({ username: "SOKRP NDA System", avatar_url: LOGO_FALLBACK, embeds: [embed] }));
    form.append('file', blob, `${name.replace(/\s+/g,'_')}_NDA.png`);

    const resp = await fetch(WEBHOOK_URL, { method: 'POST', body: form });
    if(!resp.ok) {
      const txt = await resp.text();
      throw new Error(txt || 'webhook failed');
    }

    statusEl.innerHTML = '<span class="ok">Submitted ‚Äî check Discord.</span>';
    updatePreviewText();
    updateSmallPreview();
  } catch (err) {
    console.error(err);
    statusEl.innerHTML = `<span class="err">Upload failed: ${err.message}</span>`;
    alert('Upload failed: ' + (err.message || err));
  } finally {
    submitBtn.disabled = false;
  }
}

/* ---------------- wire events ---------------- */
submitBtn.addEventListener('click', submitNDA);
[nameEl, discordEl, roleEl, notesEl].forEach(el => el.addEventListener('input', updatePreviewText));

/* initialize small preview (if any) */
updatePreviewText();
</script>
</body>
</html>
